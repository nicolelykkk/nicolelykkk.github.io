<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <style>
            body {
                margin: 0;
            }

            .axisLabel {
                font-family: Arial, Helvetica, sans-serif;
            }
        </style>
    </head>

    <body>
        <svg id="chart"></svg>
        <script>
            var URL = "https://datausa.io/api/data?drilldowns=Nation&measures=Population";

            var data = [];

            function fetchData() {

                d3.json(URL, function(error, data) {
                    console.log(data);
                    
                    var margin = {top: 50, left: 150, right: 50, bottom: 150};
                    var width = window.innerWidth;
                    var height = window.innerHeight;

                    var svg = d3.select("#chart")
                        .attr("width", width)
                        .attr("height", height);

                    // var filtered_data = data.filter(function(d){
                    //     return d.Nation === "United States";
                    //     return d.year;
                    //     return d.Population;
                    // });
                    // console.log(filtered_data)

                    // var nodes = [];
                    //     data.forEach(function(d) {
                    //         var datum = {};
                    //         datum.Nation = d.Nation;
                    //         datum.Year = d.Year;
                    //         datum.Population = d.Population;
                    //         nodes.push(datum);
                    //     });
                    // console.log(nodes);

                    var xScale = d3.scaleBand()
                        .domain(["2013", "2014", "2015", "2016", "2017", "2018"])
                        .range([margin.left, width-margin.right])
                        .padding(0.5);
                    
                    var yScale = d3.scaleLinear()
                        .domain([310000000, 330000000])
                        .range([height-margin.bottom, margin.top]);

                    var xAxis = svg.append("g")
                        .attr("class","axis")
                        .attr("transform", `translate(0,${height-margin.bottom})`)
                        .call(d3.axisBottom().scale(xScale).tickFormat(d3.format("Y")));

                    var yAxis = svg.append("g")
                        .attr("class","axis")
                        .attr("transform", `translate(${margin.left},0)`)
                        .call(d3.axisLeft().scale(yScale));

                    var bar = svg.selectAll("rect")
                        .data(data)
                        .enter()
                        .append("rect")
                            .attr("x", function(d) { return data.Year})
                            .attr("y", function(d) { return data.Population })
                            .attr("width", 50)
                            .attr("height", function(d) { return height - margin.bottom - yScale(data.Population);})
                            .attr("fill","steelblue");

                    var xAxisLabel = svg.append("text")
                        .attr("class","axisLabel")
                        .attr("x", width/2)
                        .attr("y", height-margin.bottom/2)
                        .text("Year");

                    var yAxisLabel = svg.append("text")
                        .attr("class","axisLabel")
                        .attr("transform","rotate(-90)")
                        .attr("x",-height/2)
                        .attr("y",margin.left/3)
                        .text("POPULATION");

                            });

            }

            fetchData();
        </script>

    </body>
</html>